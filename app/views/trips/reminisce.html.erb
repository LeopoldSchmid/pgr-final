<div class="container mx-auto px-4 py-6">
  <!-- Navigation Context Indicator -->
  <%= navigation_context_indicator.html_safe if navigation_context_indicator %>
  
  <!-- Trip Header -->
  <div class="bg-background-secondary rounded-2xl shadow-lg p-6 mb-6">
    <div class="mb-4">
      <%= link_to reminisce_path, class: "text-primary-accent hover:text-blue-400 font-medium flex items-center group mb-3" do %>
        <span class="transform group-hover:-translate-x-1 transition-transform mr-2">‚Üê</span> All Memories
      <% end %>
      <h1 class="text-2xl font-bold text-text-primary">
        <%= @trip.name %>
      </h1>
    </div>
    
    <div class="flex items-center space-x-3 text-sm">
      <span class="bg-purple-600 text-white px-3 py-1 rounded-lg font-medium">
        Memories
      </span>
      <% if @trip.start_date && @trip.end_date %>
        <span class="text-text-secondary">
          <%= @trip.start_date.strftime("%b %d") %> - <%= @trip.end_date.strftime("%b %d, %Y") %>
        </span>
      <% end %>
      <span class="text-text-secondary">
        <%= @journal_entries.count %> memories captured
      </span>
    </div>
  </div>

  <!-- Primary Memory Actions -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    
    <!-- Photo Gallery -->
    <% images_count = @entries_with_images.sum { |e| e.images.count } %>
    <%= link_to gallery_trip_path(@trip), class: "bg-gradient-to-br from-pink-500 to-purple-600 text-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105" do %>
      <div class="flex items-center justify-between mb-4">
        <div class="text-3xl">üì∏</div>
        <div class="bg-white/20 rounded-full px-2 py-1 text-xs font-medium">
          <%= images_count %>
        </div>
      </div>
      <h3 class="text-xl font-bold mb-2">Photo Gallery</h3>
      <p class="text-pink-100 text-sm">Browse all your trip photos</p>
    <% end %>

    <!-- Trip Timeline -->
    <%= link_to timeline_path, class: "bg-gradient-to-br from-indigo-500 to-blue-600 text-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105" do %>
      <div class="flex items-center justify-between mb-4">
        <div class="text-3xl">‚è∞</div>
        <svg class="w-6 h-6 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </div>
      <h3 class="text-xl font-bold mb-2">Trip Timeline</h3>
      <p class="text-blue-100 text-sm">See your journey chronologically</p>
    <% end %>

  </div>

  <!-- Secondary Memory Tools -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
    
    <!-- View All Memories -->
    <%= link_to journal_trip_path(@trip), class: "bg-background-secondary rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow" do %>
      <div class="text-center">
        <div class="text-2xl mb-2">üìñ</div>
        <div class="text-sm font-medium text-text-primary">All Memories</div>
        <div class="text-xs text-text-secondary"><%= @journal_entries.count %> entries</div>
      </div>
    <% end %>

    <!-- Memory Map -->
    <% if @entries_with_locations.any? %>
      <%= link_to map_trip_path(@trip), class: "bg-background-secondary rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow" do %>
        <div class="text-center">
          <div class="text-2xl mb-2">üó∫Ô∏è</div>
          <div class="text-sm font-medium text-text-primary">Memory Map</div>
          <div class="text-xs text-text-secondary"><%= @entries_with_locations.count %> locations</div>
        </div>
      <% end %>
    <% else %>
      <div class="bg-gray-100 rounded-xl p-4 opacity-50">
        <div class="text-center">
          <div class="text-2xl mb-2">üó∫Ô∏è</div>
          <div class="text-sm font-medium text-gray-500">Memory Map</div>
          <div class="text-xs text-gray-400">No locations</div>
        </div>
      </div>
    <% end %>

    <!-- Favorite Moments -->
    <% favorites_count = @journal_entries.where(favorite: true).count %>
    <% if favorites_count > 0 %>
      <%= link_to journal_trip_path(@trip, search: 'favorite:true'), class: "bg-background-secondary rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow" do %>
        <div class="text-center">
          <div class="text-2xl mb-2">‚≠ê</div>
          <div class="text-sm font-medium text-text-primary">Favorites</div>
          <div class="text-xs text-text-secondary"><%= favorites_count %> special moments</div>
        </div>
      <% end %>
    <% else %>
      <div class="bg-gray-100 rounded-xl p-4 opacity-50">
        <div class="text-center">
          <div class="text-2xl mb-2">‚≠ê</div>
          <div class="text-sm font-medium text-gray-500">Favorites</div>
          <div class="text-xs text-gray-400">Mark some favorites</div>
        </div>
      </div>
    <% end %>

    <!-- Trip Report -->
    <%= link_to report_trip_path(@trip), class: "bg-background-secondary rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow" do %>
      <div class="text-center">
        <div class="text-2xl mb-2">üìä</div>
        <div class="text-sm font-medium text-text-primary">Trip Report</div>
        <div class="text-xs text-text-secondary">Summary & export</div>
      </div>
    <% end %>

  </div>

  <!-- Recent Memories Highlight -->
  <% if @journal_entries.recent.limit(3).any? %>
    <div class="bg-background-secondary rounded-xl p-4 mb-6">
      <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Recent Memories
      </h3>
      
      <div class="space-y-3">
        <% @journal_entries.recent.limit(3).each do |entry| %>
          <div class="flex items-start space-x-3 p-3 bg-background-primary rounded-lg">
            <% if entry.images.attached? %>
              <%= image_tag entry.images.first.variant(resize_to_limit: [60, 60], quality: 80), 
                  class: "w-12 h-12 rounded-lg object-cover flex-shrink-0" %>
            <% else %>
              <div class="w-12 h-12 rounded-lg bg-primary-accent/20 flex items-center justify-center flex-shrink-0">
                <span class="text-lg"><%= entry.favorite? ? '‚≠ê' : 'üìù' %></span>
              </div>
            <% end %>
            
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between mb-1">
                <h4 class="font-medium text-text-primary text-sm">
                  <%= entry.entry_date.strftime("%b %d") %>
                  <% if entry.location_name %>
                    ‚Ä¢ <%= truncate(entry.location_name, length: 20) %>
                  <% end %>
                </h4>
                <span class="text-xs text-text-secondary">
                  <%= time_ago_in_words(entry.created_at) %> ago
                </span>
              </div>
              
              <p class="text-text-secondary text-sm leading-relaxed">
                <%= truncate(entry.content, length: 100) %>
              </p>
            </div>
          </div>
        <% end %>
      </div>
      
      <%= link_to "View all memories ‚Üí", journal_trip_path(@trip), class: "text-primary-accent text-sm hover:underline mt-3 inline-block" %>
    </div>
  <% end %>

  <!-- Trip Statistics -->
  <div class="bg-background-secondary rounded-xl p-4 mb-6">
    <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
      </svg>
      Trip Statistics
    </h3>
    
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="text-center">
        <div class="text-2xl font-bold text-blue-600">
          <%= @journal_entries.count %>
        </div>
        <div class="text-sm text-text-secondary">Total Memories</div>
      </div>
      
      <div class="text-center">
        <div class="text-2xl font-bold text-yellow-600">
          <%= @journal_entries.where(favorite: true).count %>
        </div>
        <div class="text-sm text-text-secondary">Favorites</div>
      </div>
      
      <div class="text-center">
        <div class="text-2xl font-bold text-purple-600">
          <%= @entries_with_images.sum { |e| e.images.count } %>
        </div>
        <div class="text-sm text-text-secondary">Photos</div>
      </div>
      
      <div class="text-center">
        <div class="text-2xl font-bold text-green-600">
          <%= @entries_with_locations.count %>
        </div>
        <div class="text-sm text-text-secondary">Locations</div>
      </div>
    </div>
  </div>

  <!-- Trip Series Context (if applicable) -->
  <% if @related_trips.any? %>
    <div class="bg-background-secondary rounded-xl p-4 mb-6">
      <h3 class="text-lg font-semibold text-text-primary mb-3">More Memories from "<%= @trip.series_name %>" Series</h3>
      <div class="space-y-2">
        <% @related_trips.limit(3).each do |related_trip| %>
          <% if related_trip.journal_entries.any? %>
            <%= link_to reminisce_trip_path(related_trip), class: "flex items-center justify-between p-3 bg-background-primary rounded-lg hover:shadow-sm transition-shadow" do %>
              <div>
                <div class="font-medium text-text-primary"><%= related_trip.name %></div>
                <div class="text-sm text-text-secondary">
                  <%= pluralize(related_trip.journal_entries.count, 'memory') %> ‚Ä¢ 
                  <%= related_trip.start_date ? related_trip.start_date.strftime("%b %Y") : "Dates TBD" %>
                </div>
              </div>
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Empty State or Action -->
  <% if @journal_entries.empty? %>
    <div class="bg-background-secondary rounded-2xl p-12 text-center">
      <div class="text-6xl mb-4 opacity-40">üí≠</div>
      <h3 class="text-xl font-bold text-text-primary mb-3">No memories yet</h3>
      <p class="text-text-secondary mb-6">
        This trip doesn't have any captured memories to reminisce about yet.
      </p>
      
      <% if @trip.status == 'active' %>
        <%= link_to go_trip_path(@trip), class: "bg-primary-accent text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors inline-flex items-center" do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          Start Capturing Memories
        <% end %>
      <% else %>
        <div class="text-center text-text-secondary">
          Start your trip to begin capturing memories
        </div>
      <% end %>
    </div>
  <% end %>

</div>
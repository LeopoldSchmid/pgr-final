<% content_for :title, "Map - #{@trip.name}" %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-text-primary">Memory Map</h1>
  </div>

  <!-- Map - Always visible -->
  <div class="bg-background-secondary rounded-xl p-6 shadow-lg">
    <div id="memories-map"
         class="w-full h-[70vh] min-h-[400px] rounded-lg"
         data-controller="map"
         data-map-entries-value="<%= @journal_entries.map do |entry|
           {
             id: entry.id,
             latitude: entry.latitude.to_f,
             longitude: entry.longitude.to_f,
             content: entry.content,
             location: entry.location,
             entry_date: entry.entry_date.iso8601,
             favorite: entry.favorite?,
             image_url: entry.images.attached? ? rails_blob_path(entry.images.first, only_path: true) : nil
           }
         end.to_json %>"
         data-map-target="container">
    </div>

    <!-- Map Stats -->
    <div class="mt-4 flex items-center justify-between text-sm text-text-secondary">
      <div class="flex flex-wrap gap-4">
        <span><%= @journal_entries.count %> <%= 'memory'.pluralize(@journal_entries.count) %> mapped</span>
        <% if @journal_entries.any? %>
          <span><%= @journal_entries.where(favorite: true).count %> favorites</span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- List of memories with locations -->
  <% if @journal_entries.any? %>
    <div class="mt-6 space-y-4">
      <% @journal_entries.each do |entry| %>
        <div class="bg-background-secondary rounded-xl p-4 shadow-sm">
          <% if entry.location.present? %>
            <p class="text-sm font-medium text-primary-accent mb-1"><%= entry.location %></p>
          <% end %>
          <p class="text-text-primary"><%= entry.content.truncate(100) %></p>
          <p class="text-xs text-text-secondary mt-2">
            <%= entry.entry_date&.strftime("%b %d, %Y") || "No date" %>
          </p>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="mt-6 bg-background-secondary rounded-xl p-8 text-center">
      <p class="text-text-secondary text-sm">No memories with locations yet. Add location data to your memories to see them on the map.</p>
    </div>
  <% end %>
</div>
